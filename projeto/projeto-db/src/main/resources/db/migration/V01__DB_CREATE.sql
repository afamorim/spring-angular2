
CREATE TABLE PERFIL (
	CODIGO BIGSERIAL NOT NULL,
	DESCRICAO VARCHAR(45) NULL,
	FLG_ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
	PRIMARY KEY (CODIGO)
);

CREATE TABLE USUARIO (
	CODIGO BIGSERIAL NOT NULL,
	PERFIL_CODIGO BIGINT NOT NULL,
	NOME VARCHAR(100) NULL,
	SENHA VARCHAR(50) NULL,
	PRIMARY KEY (CODIGO),
	CONSTRAINT fk_USUARIO_PERFIL1
		FOREIGN KEY (PERFIL_CODIGO)
		REFERENCES PERFIL (CODIGO)
			ON DELETE NO ACTION
			ON UPDATE NO ACTION
);

ALTER TABLE USUARIO ADD ATIVO BOOLEAN NOT NULL DEFAULT TRUE;

ALTER TABLE USUARIO ADD EMAIL VARCHAR(150) NULL;

ALTER TABLE USUARIO ADD DATA_CADASTRO TIMESTAMP NOT NULL DEFAULT NOW();

ALTER TABLE PERFIL DROP FLG_ATIVO;

ALTER TABLE PERFIL ADD ATIVO BOOLEAN DEFAULT TRUE;

INSERT INTO PERFIL (CODIGO, DESCRICAO) VALUES (1, 'Administrador');

INSERT INTO PERFIL (CODIGO, DESCRICAO) VALUES (2, 'Administrador Empresa');

INSERT INTO PERFIL (CODIGO, DESCRICAO) VALUES (3, 'Gerente Loja');

INSERT INTO PERFIL (CODIGO, DESCRICAO) VALUES (4, 'Vendedor Loja');

INSERT INTO USUARIO (PERFIL_CODIGO, NOME, SENHA, ATIVO, EMAIL) VALUES
	(1, 'Administrador', '123', true, 'admin@vorticeit.com.br');

CREATE TABLE PERMISSAO(
	CODIGO BIGINT NOT NULL,
	DESCRICAO VARCHAR(100) NOT NULL,
	PRIMARY KEY (CODIGO)
);

CREATE TABLE PERFIL_PERMISSAO(
	PERFIL_CODIGO BIGINT NOT NULL,
	PERMISSAO_CODIGO BIGINT NOT NULL,
	PRIMARY KEY (PERFIL_CODIGO, PERMISSAO_CODIGO),
	CONSTRAINT fk_PP_PERFIL_CODIGO
		FOREIGN KEY (PERFIL_CODIGO)
		REFERENCES PERFIL (CODIGO)
			ON DELETE NO ACTION
			ON UPDATE NO ACTION,
	CONSTRAINT fk_PP_PERMISSAO_CODIGO
		FOREIGN KEY (PERMISSAO_CODIGO)
		REFERENCES PERMISSAO (CODIGO)
			ON DELETE NO ACTION
			ON UPDATE NO ACTION
);

INSERT INTO PERMISSAO (CODIGO, DESCRICAO) VALUES (1, 'ROLE_ESPECIE_CADASTRAR');
INSERT INTO PERMISSAO (CODIGO, DESCRICAO) VALUES (2, 'ROLE_ESPECIE_CONSULTAR');


INSERT INTO PERFIL_PERMISSAO(PERFIL_CODIGO, PERMISSAO_CODIGO) VALUES (1, 1);
INSERT INTO PERFIL_PERMISSAO(PERFIL_CODIGO, PERMISSAO_CODIGO) VALUES (1, 2);

INSERT INTO PERFIL_PERMISSAO(PERFIL_CODIGO, PERMISSAO_CODIGO) VALUES (2, 1);
INSERT INTO PERFIL_PERMISSAO(PERFIL_CODIGO, PERMISSAO_CODIGO) VALUES (2, 2);

INSERT INTO PERFIL_PERMISSAO(PERFIL_CODIGO, PERMISSAO_CODIGO) VALUES (3, 1);
INSERT INTO PERFIL_PERMISSAO(PERFIL_CODIGO, PERMISSAO_CODIGO) VALUES (3, 2);

INSERT INTO PERFIL_PERMISSAO(PERFIL_CODIGO, PERMISSAO_CODIGO) VALUES (4, 2);

ALTER TABLE usuario ALTER senha TYPE VARCHAR(150);

INSERT INTO USUARIO (PERFIL_CODIGO, NOME, SENHA, ATIVO, EMAIL) VALUES
	(4, 'Vendedor Padr√£o', '$2a$10$S1cezZgSPbfLyWd2WdyBdurq8IR1eFaFMp7pEngNNtXWxtD93HYxe', true, 'vendedor@vorticeit.com.br');

UPDATE usuario SET senha='$2a$10$S1cezZgSPbfLyWd2WdyBdurq8IR1eFaFMp7pEngNNtXWxtD93HYxe$2a$10$S1cezZgSPbfLyWd2WdyBdurq8IR1eFaFMp7pEngNNtXWxtD93HYxe' WHERE codigo=1;